<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Digischool | Register</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* General Reset and Styling */
* { box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; }
body { margin: 0; background: linear-gradient(to right, #fae3e6, transparent); display: flex; justify-content: center; padding: 10px; min-height: 100vh; }
.container { background: linear-gradient(to right, #fdebed, transparent); width: 100%; max-width: 480px; padding: 20px; border-radius: 10px; }
h3 { text-align: center; margin-bottom: 5px; }
.subtitle { text-align: center; color: #555; margin-bottom: 15px; font-size: 12px; }
label { font-size: 12px; font-weight: 600; margin-top: 10px; display: block; }
input, select { width: 100%; padding: 10px; margin-top: 6px; border-radius: 8px; border: 1px solid #ddd; font-size: 12px; color: gray; outline: none; }
input:focus, select:focus { border: 2px solid #1e90ff; }
button { width: 100%; background: #0288d1; color: #fff; border: none; padding: 12px; border-radius: 8px; font-size: 14px; margin-top: 20px; cursor: pointer; }
button:hover { background: #0277bd; }
.login { text-align: center; margin-top: 15px; font-size: 12px; color: gray; }
.login a { color: #0288d1; text-decoration: none; font-weight: 100; }
.login a:hover { text-decoration: underline; }
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
.field { display: flex; flex-direction: column; }
@media (max-width: 768px) { .form-grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<div class="container">
    <h3>Create an account</h3>
    <div class="subtitle">Enter your details below to create your account</div>

    <form id="registerForm">
        <label>School Name</label>
        <input type="text" placeholder="School Name" required>

        <label>School Email Address</label>
        <input type="email" placeholder="email@example.com" required>

        <label>Phone Number</label>
        <input type="tel" placeholder="+254712345678" inputmode="numeric" pattern="[0-9+]*" required>

        <div class="form-grid">
            <div class="field">
                <label>Institution Type</label>
                <select required>
                    <option value="" disabled selected hidden>Select Institution Type</option>
                    <option value="private">Private School</option>
                    <option value="public">Public School</option>
                </select>
            </div>

            <div class="field">
                <label>Institution Level</label>
                <select required>
                    <option value="" disabled selected hidden>Select Institution Level</option>
                    <option value="primary">Primary School</option>
                    <option value="secondary">Secondary School</option>
                    <option value="tertiary">Tertiary</option>
                </select>
            </div>

            <div class="field">
                <label>County</label>
                <select required>
                    <option value="" disabled selected hidden>Choose county</option>
                    <option>Baringo</option><option>Bomet</option><option>Bungoma</option>
                    <option>Busia</option><option>Elgeyo-Marakwet</option><option>Embu</option>
                    <option>Garissa</option><option>Homa Bay</option><option>Isiolo</option>
                    <option>Kajiado</option><option>Kakamega</option><option>Kericho</option>
                    <option>Kiambu</option><option>Kilifi</option><option>Kirinyaga</option>
                    <option>Kisii</option><option>Kisumu</option><option>Kitui</option>
                    <option>Kwale</option><option>Laikipia</option><option>Lamu</option>
                    <option>Machakos</option><option>Makueni</option><option>Mandera</option>
                    <option>Marsabit</option><option>Meru</option><option>Migori</option>
                    <option>Mombasa</option><option>Murang'a</option><option>Nairobi</option>
                    <option>Nakuru</option><option>Nandi</option><option>Narok</option>
                    <option>Nyamira</option><option>Nyandarua</option><option>Nyeri</option>
                    <option>Samburu</option><option>Siaya</option><option>Taita-Taveta</option>
                    <option>Tana River</option><option>Tharaka-Nithi</option><option>Trans Nzoia</option>
                    <option>Turkana</option><option>Uasin Gishu</option><option>Vihiga</option>
                    <option>Wajir</option><option>West Pokot</option>
                </select>
            </div>

            <div class="field">
                <label>Product</label>
                <select required>
                    <option value="" disabled selected hidden>Select Product</option>
                    <option value="fees">Fee Management</option>
                    <option value="exams">Exam Analysis</option>
                </select>
            </div>

            <div class="field">
                <label>Students Population</label>
                <select required>
                    <option value="" disabled selected hidden>Choose Students Population</option>
                    <option>Up to 500 Students</option>
                    <option>Up to 1000 Students</option>
                    <option>Up to 1500 Students</option>
                    <option>2000 and Above Students</option>
                </select>
            </div>

            <div class="field">
                <label>Password</label>
                <input type="password" id="password" placeholder="Enter password" required>
            </div>

            <div class="field">
                <label>Confirm Password</label>
                <input type="password" id="confirmPassword" placeholder="Confirm password" required>
            </div>
        </div>

        <button type="submit">Create account</button>
    </form>

    <div class="login">
        Already have an account? <a href="./login.html">Log in</a>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, sendSignInLinkToEmail, signInWithPhoneNumber, RecaptchaVerifier } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyB8HwfE9-ObuCZbaWQ1Z2L8F3kL_Sv8EVY",
  authDomain: "digischool-90ea0.firebaseapp.com",
  projectId: "digischool-90ea0",
  storageBucket: "digischool-90ea0.firebasestorage.app",
  messagingSenderId: "63814149016",
  appId: "1:63814149016:web:d1c508af4c210d2a36c1ed",
  measurementId: "G-YRHM99F3L4"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

document.getElementById("registerForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const form = e.target;
    const password = document.getElementById("password").value.trim();
    const confirmPassword = document.getElementById("confirmPassword").value.trim();
    const email = form[1].value.trim();

    if(password !== confirmPassword){
        alert("Passwords do not match!");
        return;
    }

    try {
        // Create Firebase Authentication user with email & password
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);

        // Save extra school data in Firestore
        const schoolData = {
            name: form[0].value.trim(),
            email,
            phone: form[2].value.trim(),
            type: form[3].value,
            level: form[4].value,
            county: form[5].value,
            product: form[6].value,
            population: form[7].value,
            uid: userCredential.user.uid
        };

        await addDoc(collection(db, "schools"), schoolData);

        alert("Registration successful! Redirecting to login page...");
        window.location.href = "login.html";

    } catch (error) {
        alert("Error: " + error.message);
    }
});
</script>

</body>
</html>
