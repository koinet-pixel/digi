<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Email Verification</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial, Helvetica, sans-serif;}
body{
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    background:linear-gradient(135deg,#fdebed,#fae3e6);
}
.container{
    background:#fff;
    padding:25px;
    border-radius:12px;
    box-shadow:0 8px 20px rgba(0,0,0,0.15);
    max-width:380px;
    width:90%;
    text-align:center;
}
h2{
    color:#d32f2f;
    margin-bottom:15px;
}
p{
    color:#555;
    font-size:14px;
    margin-bottom:20px;
}
button{
    width:100%;
    padding:12px;
    background:#d32f2f;
    color:#fff;
    border:none;
    border-radius:8px;
    font-size:15px;
    cursor:pointer;
    margin-bottom:10px;
}
button:hover{
    background:#b71c1c;
}
.link{
    font-size:13px;
    color:#0288d1;
    cursor:pointer;
    text-decoration:underline;
}
</style>
</head>
<body>

<div class="container">
    <h2>Verify Your Email</h2>
    <p>A verification link has been sent to your email address.  
    Please check your inbox and click the link to activate your account.</p>

    <button onclick="checkVerification()">I've Verified My Email</button>
    <div class="link" onclick="resendEmail()">Resend Verification Email</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { 
    getAuth, 
    sendEmailVerification,
    onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";

const firebaseConfig = {
apiKey: "AIzaSyB8HwfE9-ObuCZbaWQ1Z2L8F3kL_Sv8EVY",
  authDomain: "digischool-90ea0.firebaseapp.com",
  projectId: "digischool-90ea0",
  storageBucket: "digischool-90ea0.firebasestorage.app",
  messagingSenderId: "63814149016",
  appId: "1:63814149016:web:d1c508af4c210d2a36c1ed",
  measurementId: "G-YRHM99F3L4"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// Check if user is logged in
onAuthStateChanged(auth, async (user) => {

    if (!user) {
        window.location.href = "login.html";
        return;
    }

    if (user.emailVerified) {
        window.location.href = "user-dashboard.html";
        return;
    }

    // Send verification email once
    if (!user.emailVerified) {
    console.log("Waiting for email verification...");
}

});

// Check verification
window.checkVerification = async function(){
    const user = auth.currentUser;

    if (!user) {
        window.location.href = "login.html";
        return;
    }

    await user.reload();

    if (user.emailVerified) {
        alert("Email Verified!");
        window.location.href = "user-dashboard.html";
    } else {
        alert("Still not verified. Please check your email.");
    }
};

// Resend email
window.resendEmail = async function(){
    const user = auth.currentUser;

    if (!user) {
        window.location.href = "login.html";
        return;
    }

    await sendEmailVerification(user);
    alert("Verification email resent.");
};
</script>

</body>
</html>
